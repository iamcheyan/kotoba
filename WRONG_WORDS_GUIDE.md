# Kotoba - 错题本功能使用指南

## 功能概述

已成功为 Kotoba 添加了错题本功能，可以自动记录做错的单词，并支持云端同步和专门练习。

## 主要功能

### 1. **自动记录错题**
- ✅ 答错时自动添加到错题本
- ✅ 避免重复添加相同单词
- ✅ 记录单词、意思、读音和添加时间

### 2. **错题本词典**
- ✅ 在词典选择中显示为"📕 錯題本"
- ✅ 位于词典列表最顶部，方便快速访问
- ✅ 显示错题本中的单词数量

### 3. **云端同步**
- ✅ 错题本数据自动同步到 Firebase
- ✅ 多设备间自动合并去重
- ✅ 登录后自动加载云端错题本

### 4. **界面优化**
- ✅ 去掉了"不正解"和"総単語"的显示
- ✅ 只显示"正解: X"，界面更简洁

## 使用方法

### 开始练习
1. 选择任意词典开始答题
2. 答错的单词会自动添加到错题本
3. 控制台会显示"已添加到错题本: XXX"

### 查看错题本
1. 点击页面上方的「📘 辞書」按钮
2. 在词典列表中选择「📕 錯題本」
3. 点击「確認」开始练习错题

### 练习错题
- 选择错题本后，系统会随机从错题中出题
- 只会出现你之前答错的单词
- 继续答错的单词不会重复添加

### 清空错题本
如果需要清空错题本：
1. 打开浏览器开发者工具（F12）
2. 在控制台输入：`localStorage.removeItem('wrongWords')`
3. 刷新页面

## 技术实现

### 数据结构
```javascript
wrongWords: [
  {
    kanji: "単語",      // 单词（汉字/假名）
    meaning: "词语",    // 意思
    reading: "たんご",  // 读音
    addedAt: "2025-10-13T12:00:00.000Z"  // 添加时间
  },
  // ... 更多单词
]
```

### 存储位置
- **本地**: `localStorage.wrongWords`
- **云端**: `Firestore.users.[uid].wrongWords`

### 同步机制
1. **答错时**: 自动添加到本地 → 1秒后自动同步到云端
2. **登录时**: 从云端加载 → 与本地数据合并去重
3. **手动同步**: 点击"データを同期"立即同步

### 文件修改

#### 1. config.json
```json
{
  "path": "wrong-words",
  "name": "📕 錯題本",
  "isWrongWords": true
}
```

#### 2. app.js
- 添加 `addToWrongWords()` 函数：在答错时记录单词
- 添加 `loadWrongWordsDict()` 函数：加载错题本数据
- 修改 `loadRandomEntry()` 函数：支持从错题本加载
- 修改 `evaluateAnswer()` 函数：答错时调用记录函数
- 修改 `updateScoreboard()` 函数：简化显示

#### 3. index.html (Firebase 脚本)
- `syncUserData()`: 同步错题本到云端
- `loadUserData()`: 从云端加载并合并错题本

## 使用场景

### 场景 1: 新手学习
1. 选择"入門（单字/N5）"开始学习
2. 答错的单词自动记录
3. 练习一段时间后，切换到错题本
4. 专门练习之前不会的单词

### 场景 2: 考前复习
1. 使用各种词典大量练习
2. 累积错题本
3. 考前切换到错题本
4. 重点攻克薄弱环节

### 场景 3: 多设备学习
1. 在电脑上练习，积累错题
2. 在手机上登录同一账户
3. 错题本自动同步
4. 可以在手机上继续练习错题

## 注意事项

1. **首次使用**: 错题本初始为空，需先答错题目才能使用
2. **去重机制**: 同一单词只会记录一次，重复答错不会重复添加
3. **云端同步**: 需要登录 Google 账户才能同步
4. **数据安全**: 错题本数据存储在用户的 Firebase 账户中
5. **离线使用**: 未登录时错题本仍可正常使用，数据保存在本地

## 快捷键支持

所有原有的快捷键依然可用：
- **Enter**: 提交答案/下一题
- **跳过按钮**: 跳过当前题目（不计入错题本）

## 统计信息

错题本会显示：
- 控制台：当前错题本中的单词数量
- 选择词典时：可以看到错题本选项

## 开发者备注

- 错题本使用虚拟词典 ID: `wrong-words`
- 不需要实际的 JSON 文件
- 数据完全来自 localStorage
- 自动同步延迟：1 秒（防抖）

---

**功能完成时间**: 2025-10-13  
**新增功能**:
- ✅ 错题本自动记录
- ✅ 云端同步支持
- ✅ 词典选择集成
- ✅ 界面显示优化

